var http=require('http');
var router=require('router');
var Mongodb=require('mongodb').MongoClient;

http.createServer(router).listen(3000);

router.get("get",function(req,res){
	res.send("get");
});
router.get("post",function(req,res){
	console.log('post!');
});
router.post("logined",function(req,res){
	console.log('logined!');
});
router.get("add",function(req,res){
	var DBurl='mongodb://localhost:27017/';
	Mongodb.connect(DBurl,{useNewUrlParser: true },function(err,db){
		if(err)
			console.log(err);
		dbo=db.db('test');
		dbo.collection('user').insertOne({'name':'nn'},function(err){
			if(err)
				res.send("insert fail");
			else
				res.send("insert success");	
		});
	});
});
router.get("remove",function(req,res){
	var DBurl='mongodb://localhost:27017/';
	Mongodb.connect(DBurl,{useNewUrlParser: true },function(err,db){
		if(err)
			console.log(err);
		dbo=db.db('test');
		dbo.collection('user').deleteOne({'name':'nn'},function(err){
			if(err)
				res.send("delete fail");
			else
				res.send("delete success");	
		});
	});
});
router.get("update",function(req,res){
	var DBurl='mongodb://localhost:27017/';
	Mongodb.connect(DBurl,{useNewUrlParser: true },function(err,db){
		if(err){
			console.log(err);
		}
		dbo=db.db('test');
		dbo.collection('user').updateMany({'name':''},{$set:{'name':'2'}},function(err,info){
			if(err)
				res.send("delete fail");
			else{
				console.log(info.result.nModified);	
				var n=info.result.nModified;
				res.send(n);
			}
		});
	});
});
router.get("find",function(req,res){
	var DBurl='mongodb://localhost:27017/';
	Mongodb.connect(DBurl,{useNewUrlParser: true },function(err,db){
		if(err){
			console.log(err);
		}
		dbo=db.db('test');
		dbo.collection('user').find({}).sort({'type':-1}).toArray(function(err,info){
			if(err)
				res.send("find fail");
			else{
				
				console.log(info);	
				
			}
		});
	});
});